#include "Keyboard.h"


//接口定义
#define spin_j A0
#define spin_k A1
#define spin_f A2
#define spin_d A3

long int currentTime = 0, startScanningTime = 0;

char buttons[4] = {'d','f','j','k'};

char scanningButton = '';

char detectedButton = '';

int buttonCount = 0;

void setup() {
  Keyboard.begin();
  Serial.begin(9600);
  pinMode (A1, INPUT_PULLUP)；
  pinMode (7, OUTPUT);
}

void loop() {
    int dvalue = analogRead(spin_d); //左淵
    int kvalue = analogRead(spin_k);  //右淵
    int jvalue = analogRead(spin_j);   //右面
    int fvalue = analogRead(spin_f);  //左面
    int index = 0;


    if (dvalue == HIGH) {
        index = 0;
        currentTime = millis();
    }
    else if (fvalue == HIGH) {
        index = 1;
        currentTime = millis();
    }
    else if (jvalue == HIGH) {
        index = 2;
        currentTime = millis();
    }
    else if (kvalue == HIGH) {
        index = 3;
        currentTime = millis();
    }
    //检测到输入，开始计时

    detectedButton = buttons[index];
    if (detectedButton == scanningButton){
        buttonCount++;
        if (buttonCount>=10){
        //检测到来自同一按键的10次高电平，输出到键盘
            Keyboard.write(scanningButton);
            currentTime = millis();
            //再次记录时间保证准确延迟
            Serial.println(scanningButton+" Latency: "+String(currentTime-startScanningTime)+" ms");
        }
    }else{
    //识别到其他按键，重置识别次数
        scanningButton = detectedButton;
        buttonCount = 1;
        startScanningTime = currentTime;
    }
}